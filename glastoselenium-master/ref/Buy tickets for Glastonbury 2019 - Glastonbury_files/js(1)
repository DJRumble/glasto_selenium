function format(n,t,i){return n.replace(t,i)}function hasDuplicates(n){for(var i=[],t=0;t<n.length;t++){if(i.indexOf(n[t])!==-1)return!0;i.push(n[t])}return!1}function displayHidePostcode(){var t=$("#Order_Address_Country").val(),n;t==="IE"||t==="HK"?($("#Container_Order_Address_Postcode").hide(),$("#Order_Address_Postcode").val("******")):($("#Container_Order_Address_Postcode").show(),n=$("#Order_Address_Postcode").val(),$("#Order_Address_Postcode").val(n=="******"?"":n))}function toTitleCase(n){return n.replace(/\w\S*/g,function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()})}function formatTicketPlanOrderItems(){var n=$('.order-items td:contains("TICKET PLAN")').parents("tr"),t;if(n.length>0){if(n.eq(0).find("td.quantity").text("1"),n<2)return;t=0;$.each(n,function(){t+=parseFloat($(this).find("td.price").text().trim().substring(1))});n.eq(0).find("td.price").text("Â£"+new Number(parseFloat(t)).toFixed(2));n.slice(1).hide()}}function preSelectFirstPrice(){$.each($(".registered-user select"),function(n,t){var i=$(t).find("option:eq(1)");i.length>0&&i.attr("selected","selected")})}var registrationValidator={regIdFormat:null,postcodeIdFormat:null,init:function(n,t,i,r){registrationValidator.regIdFormat=i;registrationValidator.postcodeIdFormat=r;registrationValidator.addRequiredValidation(format(i,"{0}",0),"Please enter a registration number",function(){return!0},!0);registrationValidator.addRequiredValidation(format(r,"{0}",0),"Please enter a postcode",function(){return!0},!1);for(var u=1;u<t;u++)registrationValidator.fieldMatching(i,u),registrationValidator.fieldMatching(r,u);$("body").on("submit","#"+n.attr("id"),function(){var n=$('input[name$="RegistrationId"]').map(function(){return $(this).val()!=""?$(this).val():null}).get();return hasDuplicates(n)?(alert("You have entered duplicate registration numbers on this page. Please check your details."),!1):!0})},addRequiredValidation:function(n,t,i,r){$(n).rules("add",{required:{depends:function(){return $(this).val($.trim($(this).val())),i()}},digits:r,messages:{required:t,digits:"Please enter a valid registration number"}})},fieldMatching:function(n,t){var i=n==registrationValidator.regIdFormat?registrationValidator.postcodeIdFormat:registrationValidator.regIdFormat,r=n==registrationValidator.regIdFormat?"Please enter a registration number":"Please enter a postcode";registrationValidator.addRequiredValidation(format(n,"{0}",t),r,function(n){return function(){return $(format(i,"{0}",n)).val()!=""}}(t),n==registrationValidator.regIdFormat?!0:!1)}},priceValidation={init:function(n,t,i,r,u,f,e){$("body").on("submit","#"+n.attr("id"),function(){var n=0,o=!1;return f.hide(),(t.length==0||e)&&(i.each(function(){parseInt($(this).val())>0&&(o=!0)}),o?u.hide():(u.addClass("field-validation-error"),u.css("display","block"),u.text(e?"You must select a coach ticket for each registration":"Please choose at least one type of ticket to buy"),n=1)),t.length>0&&t.each(function(t){var i=$(format(r,"{0}",t));parseInt($(this).val())<=0||isNaN(parseInt($(this).val()))?(i.text("Please select a ticket type"),i.css("display","block"),n++):i.css("display","none")}),n==0})}},coachSelector;jQuery.validator.unobtrusive.adapters.add("brequired",function(n){n.element.tagName.toUpperCase()=="INPUT"&&n.element.type.toUpperCase()=="CHECKBOX"&&(n.rules.required=!0,n.message&&(n.messages.required=n.message))});coachSelector={init:function(n,t){var u;coachSelector.reset();$(".price-list option").not('[value="'+t+'"]').remove();$(".price-list select").prepend('<option value="0">0<\/option>');var e=$(".price-list tr.tr-border"),f=e.find("td:first"),i=[],r=$("#town_filter");$.each(f,function(n,t){i.push(toTitleCase($(t).text().trim().split(" ")[0]))});i=coachSelector.unique(i);i.sort();$.each(i,function(n,t){r.append('<option value="'+t.toLowerCase()+'">'+t+"<\/option>")});u=$("<input>").attr("type","hidden").attr("name","coachTownSelected").attr("id","coachTownSelected");$(".evt-price-list form").append($(u));$("body").on("change","#"+r.attr("id"),function(){var t=$(this).prop("selectedIndex"),n=$("#town_filter option:selected").text();$(u).val(n.toLowerCase());t==0?(coachSelector.reset(),$(".valid-quantity").hide()):($(".price-list tr").slice(1).hide(),$(".price-list select").prop("selectedIndex",0),$.each(f,function(t,i){toTitleCase($(i).text().trim().split(" ")[0])==n.trim()&&($(i).parent().show(),$(i).parent("tr").nextAll("tr").eq(0).hasClass("desc")&&$(i).parent("tr").nextAll("tr").eq(0).show())}),$(".additional-coach-seats").show(),$(".price-list").show(),$("#buyTickets").show())});n!=null&&n!=""&&(r.val(n),r.trigger("change"))},unique:function(n){return $.grep(n,function(t,i){return i==$.inArray(t,n)})},reset:function(){$(".coach-town-select").show();$(".price-list").hide();$("#buyTickets").hide();$(".additional-coach-seats").hide()}}